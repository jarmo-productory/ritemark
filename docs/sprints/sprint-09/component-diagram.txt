# Sprint 9: Component Architecture Diagram (ASCII Art)

## Component Hierarchy (Nested Tree)

```
App.tsx (Root)
â”‚
â”œâ”€â”€ AuthProvider (Context)
â”‚   â”‚
â”‚   â””â”€â”€ SidebarProvider (shadcn Context)
â”‚       â”‚
â”‚       â”œâ”€â”€ Sidebar (shadcn Component, collapsible="icon", side="left")
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ SidebarHeader
â”‚       â”‚   â”‚   â””â”€â”€ FileStatusIndicator
â”‚       â”‚   â”‚       â”œâ”€â”€ StatusIcon (ğŸ“„/ğŸ”„/ğŸ”´/â˜ï¸âŒ)
â”‚       â”‚   â”‚       â”œâ”€â”€ YellowDotBadge (ğŸŸ¡ if unsaved)
â”‚       â”‚   â”‚       â””â”€â”€ Filename (truncated with ellipsis)
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ SidebarContent
â”‚       â”‚   â”‚   â””â”€â”€ SidebarGroup
â”‚       â”‚   â”‚       â””â”€â”€ TableOfContentsNav
â”‚       â”‚   â”‚           â””â”€â”€ TOCItems (conditional: if headings > 0)
â”‚       â”‚   â”‚               â”œâ”€â”€ Heading 1 (level 1)
â”‚       â”‚   â”‚               â”œâ”€â”€ Heading 2 (level 2)
â”‚       â”‚   â”‚               â””â”€â”€ Heading 3 (level 3)
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ SidebarFooter
â”‚       â”‚       â””â”€â”€ UserAccountInfo
â”‚       â”‚           â”œâ”€â”€ Avatar (circular image)
â”‚       â”‚           â”œâ”€â”€ UserName (with verified badge)
â”‚       â”‚           â””â”€â”€ UserEmail (muted)
â”‚       â”‚           â””â”€â”€ onClick â†’ AuthModal (logout)
â”‚       â”‚
â”‚       â””â”€â”€ main (Content Area)
â”‚           â”‚
â”‚           â”œâ”€â”€ NoFileDialog (conditional: if !fileId)
â”‚           â”‚   â”œâ”€â”€ OpenButton â†’ DriveFilePicker
â”‚           â”‚   â””â”€â”€ CreateNewButton â†’ SaveAsDialog
â”‚           â”‚
â”‚           â””â”€â”€ Editor (conditional: if fileId)
â”‚               â””â”€â”€ TipTap WYSIWYG (pure content, no UI)
```

---

## State Flow (Data Propagation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Global Context Layer                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AuthContext                 SidebarProvider                 â”‚
â”‚  â”œâ”€â”€ user                    â”œâ”€â”€ state (collapsed/expanded)  â”‚
â”‚  â”œâ”€â”€ isAuthenticated         â”œâ”€â”€ open                        â”‚
â”‚  â”œâ”€â”€ login()                 â”œâ”€â”€ setOpen()                   â”‚
â”‚  â””â”€â”€ logout()                â””â”€â”€ toggleSidebar()             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                     â”‚
                  â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Custom Hooks Layer                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  useDriveSync              useDriveFiles      useAuth        â”‚
â”‚  â”œâ”€â”€ syncStatus            â”œâ”€â”€ files[]        â”œâ”€â”€ user       â”‚
â”‚  â”œâ”€â”€ loadFile()            â”œâ”€â”€ isLoading      â”œâ”€â”€ isAuth     â”‚
â”‚  â””â”€â”€ forceSave()           â””â”€â”€ refresh()      â””â”€â”€ logout()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                  â”‚                     â”‚               â”‚
                  â†“                     â†“               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Component Layer                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FileStatusIndicator   TableOfContentsNav  UserAccountInfo  â”‚
â”‚  â† syncStatus          â† editor           â† user            â”‚
â”‚                        â† editor.state.doc â† isAuthenticated â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Auto-save Flow (User Types â†’ Drive Save â†’ Status Update)

```
User types in Editor
      â”‚
      â†“
setText(newContent)  â† App.tsx state update
      â”‚
      â†“
useDriveSync watches 'text' prop change
      â”‚
      â†“
autoSaveManager.scheduleSave(content)
      â”‚
      â†“
3-second debounce timer starts
      â”‚
      â†“
[User types more... debounce resets]
      â”‚
      â†“
3 seconds of no typing â†’ Debounce expires
      â”‚
      â†“
setSyncStatus({ status: 'saving' })
      â”‚
      â†“
FileStatusIndicator re-renders â†’ Shows ğŸ”„ (spinning loader)
      â”‚
      â†“
if (fileId) {
  PATCH /drive/v3/files/{fileId}  â† Update existing file
} else {
  POST /upload/drive/v3/files      â† Create new file
  onFileCreated(newFileId)
}
      â”‚
      â†“
setSyncStatus({ status: 'synced', lastSaved: now })
      â”‚
      â†“
FileStatusIndicator re-renders â†’ Shows ğŸ“„ (document icon)
```

---

## File Open Flow (User Clicks "Open" â†’ Load from Drive)

```
User clicks "Open File" button
      â”‚
      â†“
NoFileDialog.onOpenFile() called
      â”‚
      â†“
App.tsx: setShowFilePicker(true)
      â”‚
      â†“
DriveFilePicker modal appears
      â”‚
      â†“
User selects file from picker
      â”‚
      â†“
onFileSelect(file) callback
      â”‚
      â†“
App.tsx: handleFileSelect(file)
      â”‚
      â†“
useDriveSync.loadFile(file.id)
      â”‚
      â†“
setSyncStatus({ status: 'saving' })  â† Reuse 'saving' for loading
      â”‚
      â†“
GET /drive/v3/files/{fileId}?fields=...  â† Fetch metadata
GET /drive/v3/files/{fileId}?alt=media   â† Fetch content
      â”‚
      â†“
setFileId(file.id)
setTitle(file.name)
setText(content)
      â”‚
      â†“
setSyncStatus({ status: 'synced', lastSaved: file.modifiedTime })
      â”‚
      â†“
Editor re-renders with loaded content
```

---

## Create New Flow (User Clicks "Create New" â†’ Save As)

```
User clicks "Create New" button
      â”‚
      â†“
NoFileDialog.onCreateNew() called
      â”‚
      â†“
App.tsx: setShowSaveAsDialog(true)
      â”‚
      â†“
SaveAsDialog modal appears
      â”‚
      â†“
User enters filename: "My Document"
User clicks "Choose folder..." â†’ Google Drive Picker
User selects folder â†’ Shows folder name
      â”‚
      â†“
User clicks "Create" button
      â”‚
      â†“
onSave("My Document.md", selectedFolderId)
      â”‚
      â†“
App.tsx: handleSaveAs(fileName, folderId)
      â”‚
      â†“
createDriveFile(fileName, "", accessToken, folderId)
      â”‚
      â†“
POST /upload/drive/v3/files?uploadType=multipart
Body: {
  metadata: { name: "My Document.md", parents: [folderId] },
  content: ""  â† Empty file
}
      â”‚
      â†“
Response: { id: "newFileId123" }
      â”‚
      â†“
setFileId("newFileId123")
setTitle("My Document")
setText("")
setShowSaveAsDialog(false)
      â”‚
      â†“
Editor opens with empty file
      â”‚
      â†“
User starts typing â†’ Auto-save kicks in (3s debounce)
```

---

## Sidebar Collapsed vs Expanded States

### Collapsed State (Icon Mode - Default)

```
â”Œâ”€â”
â”‚ğŸ“„â”‚  â† File status icon (doc/sync/alert + yellow dot badge)
â”‚ â”‚
â”‚ğŸ“‘â”‚  â† TOC icon (only if headings exist)
â”‚ â”‚
â”‚ğŸ‘¤â”‚  â† User avatar
â””â”€â”˜
 ^
48-64px wide (thin vertical bar)
```

**Behavior:**
- Default state on page load
- Provides maximum content area for writing
- Click any icon â†’ Expands sidebar
- Keyboard: `Cmd+B` / `Ctrl+B` â†’ Toggles to expanded

---

### Expanded State

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“„ My Doc.md â”‚  â† File status + filename (truncated if too long)
â”‚              â”‚
â”‚ Contents     â”‚  â† TOC section header
â”‚  - Heading 1 â”‚  â† TOC item (level 1)
â”‚    - Sub 1.1 â”‚  â† TOC item (level 2, indented)
â”‚  - Heading 2 â”‚  â† TOC item (level 1)
â”‚              â”‚
â”‚ ğŸ‘¤ John Doe  â”‚  â† User name
â”‚   john@e.com â”‚  â† User email
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      ^
240-280px wide (narrow sidebar)
```

**Behavior:**
- Shows full information (filename, TOC items, user name/email)
- Click anywhere on user info â†’ Opens logout dialog
- Click TOC item â†’ Scrolls editor to heading
- Keyboard: `Cmd+B` / `Ctrl+B` â†’ Toggles to collapsed
- State persists via cookies (30 days)

---

## Mobile Responsive Behavior (<768px)

### Collapsed State (Default on Mobile)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜°                                    â”‚  â† Hamburger button (top-left)
â”‚                                      â”‚
â”‚        Pure Content Area             â”‚
â”‚                                      â”‚
â”‚  (Editor with no UI chrome)          â”‚
â”‚                                      â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Expanded State (Overlay Mode)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“„ My Doc.md â”‚ [Dimmed Background]   â”‚  â† Sidebar overlay
â”‚              â”‚                       â”‚
â”‚ Contents     â”‚ Tap outside â†’         â”‚
â”‚  - Heading 1 â”‚ Closes sidebar        â”‚
â”‚  - Heading 2 â”‚                       â”‚
â”‚              â”‚                       â”‚
â”‚ ğŸ‘¤ John Doe  â”‚                       â”‚
â”‚   john@e.com â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Behavior:**
- Tap hamburger â†’ Sidebar slides in from left (overlay)
- Full-width overlay (dims content behind)
- Tap outside sidebar â†’ Closes sidebar
- Swipe gestures (if shadcn implements)

---

## Component File Locations

### New Components (Create These)

```
ritemark-app/src/components/
â”‚
â”œâ”€â”€ sidebar/
â”‚   â”œâ”€â”€ AppSidebar.tsx              â† Main sidebar wrapper
â”‚   â”œâ”€â”€ FileStatusIndicator.tsx     â† Status icon + filename
â”‚   â”œâ”€â”€ TableOfContentsNav.tsx      â† Migrated TOC functionality
â”‚   â””â”€â”€ UserAccountInfo.tsx         â† User display + logout
â”‚
â””â”€â”€ dialogs/
    â”œâ”€â”€ NoFileDialog.tsx            â† Center dialog (Open/Create New)
    â””â”€â”€ SaveAsDialog.tsx            â† Filename + folder picker
```

---

### Old Components (Delete These)

```
ritemark-app/src/components/
â”‚
â”œâ”€â”€ FileMenu.tsx                    â† âŒ DELETE
â”‚
â”œâ”€â”€ auth/
â”‚   â””â”€â”€ AuthStatus.tsx              â† âŒ DELETE
â”‚
â”œâ”€â”€ drive/
â”‚   â””â”€â”€ SaveStatus.tsx              â† âŒ DELETE
â”‚
â””â”€â”€ TableOfContents.tsx             â† âŒ DELETE
```

---

### Files to Update

```
ritemark-app/src/
â”‚
â”œâ”€â”€ App.tsx                         â† âœï¸ UPDATE (integrate SidebarProvider + AppSidebar)
â”œâ”€â”€ App.css                         â† âœï¸ UPDATE (remove old component styles)
â””â”€â”€ index.css                       â† âœï¸ UPDATE (add shadcn sidebar CSS variables)
```

---

## Hook Dependencies Map

| Component              | Hooks Used          | Data Consumed                     | Actions Called                    |
|------------------------|---------------------|-----------------------------------|-----------------------------------|
| AppSidebar             | useSidebar          | state, open, isMobile             | toggleSidebar(), setOpen()        |
| FileStatusIndicator    | useDriveSync        | syncStatus                        | -                                 |
| TableOfContentsNav     | (none - editor prop)| editor.state.doc (ProseMirror)    | editor.chain().setTextSelection() |
| UserAccountInfo        | useAuth             | user, isAuthenticated             | logout() (via AuthModal)          |
| NoFileDialog           | (none - pure UI)    | -                                 | Parent callbacks                  |
| SaveAsDialog           | useDriveFiles (opt) | files (for folder picker)         | createDriveFile() (via parent)    |

---

## Status Icon States

| Status       | Icon             | Color          | Meaning                        | Trigger                          |
|--------------|------------------|----------------|--------------------------------|----------------------------------|
| synced       | ğŸ“„ FileText      | Default        | All changes saved              | After successful save            |
| saving       | ğŸ”„ Loader2       | Blue (#3b82f6) | Currently saving to Drive      | During Drive API PATCH/POST      |
| error        | ğŸ”´ AlertCircle   | Red (#dc2626)  | Save failed                    | Drive API error, network failure |
| offline      | â˜ï¸âŒ CloudOff     | Gray (#6b7280) | No network connection          | navigator.onLine === false       |
| unsaved (badge) | ğŸŸ¡ Yellow Dot | Yellow (#fbbf24) | Unsaved changes detected    | Immediately when user types      |

---

## Migration Phases (10-Day Timeline)

```
Day 1-2:  Preparation
          â”œâ”€â”€ Install shadcn sidebar
          â”œâ”€â”€ Create file structure
          â””â”€â”€ Review documentation

Day 3-5:  Build New Components
          â”œâ”€â”€ Day 3: AppSidebar + FileStatusIndicator
          â”œâ”€â”€ Day 4: TableOfContentsNav + UserAccountInfo
          â””â”€â”€ Day 5: NoFileDialog + SaveAsDialog

Day 6-7:  Wire Up State
          â”œâ”€â”€ Day 6: Connect hooks to components
          â””â”€â”€ Day 7: Integration testing + Remove old components

Day 8-9:  Testing & Polish
          â”œâ”€â”€ Day 8: Manual testing (full checklist)
          â””â”€â”€ Day 9: Bug fixes + edge cases

Day 10:   Documentation & PR
          â”œâ”€â”€ Update component docs
          â”œâ”€â”€ Create screenshots (before/after)
          â””â”€â”€ Code review + merge
```

---

## Quality Metrics (Success Criteria)

| Metric                        | Target          | Measurement                     |
|-------------------------------|-----------------|----------------------------------|
| TypeScript compilation        | Zero errors     | npm run type-check              |
| ESLint validation             | Zero errors     | npm run lint                    |
| Test coverage                 | > 80%           | npm run test:coverage           |
| Sidebar collapse/expand       | < 200ms         | Performance profiler            |
| File status update            | < 50ms          | Performance profiler            |
| TOC update on content change  | < 100ms         | Performance profiler            |
| Auto-save debounce            | 3s              | Timer validation                |
| Large doc scroll (1000+ lines)| < 100ms         | Performance profiler            |
| Mobile responsiveness         | Works on 320px  | Device testing                  |
| WCAG AA compliance            | 100%            | Accessibility audit             |

---

## Risk Mitigation Summary

| Risk                              | Severity | Mitigation                                      |
|-----------------------------------|----------|-------------------------------------------------|
| Breaking existing functionality   | High     | Git checkpoint, comprehensive testing, rollback plan |
| Poor mobile UX                    | Low      | Use shadcn defaults (tested by shadcn team)     |
| Performance degradation           | Low      | useMemo, useCallback, performance testing       |
| Users confused by icons           | Medium   | Tooltips (future), error toasts for critical    |
| shadcn sidebar bugs               | Low      | Pin version, fork if needed                     |
| OAuth token expires mid-operation | Medium   | Auto-refresh tokens, retry logic                |
| Drive API quota exceeded          | Low      | 3s debounce, rate limiting                      |

---

**End of Component Diagram**
